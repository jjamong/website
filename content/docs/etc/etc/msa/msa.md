---
weight: 1
slug: index
date: 2022-04-08
title: "MSA(Microservices Architecture)"
description: "MSA(Microservices Architecture)"
toc: true
---

`참고` : https://bcho.tistory.com/948


## Monolithic Architecture(모노리틱 아키텍쳐)

MSA를 이해하기 전에 먼저 MA(모노리틱 아키텍쳐) 스타일에 대해서 이해해야 합니다.

모노리틱 아키텍쳐 스타일은 기존의 전통적인 웹 시스템 개발 스타일로, 하나의 애플리케이션 내에 모든 로직들이 모두 들어 가 있는 구조 입니다.

<br>

MA 스타일의 쇼핑몰 애플리케이션(웹사이트)이 있다고 가정해 보겠습니다.

그 안에 각 컴포넌트(UX, 회원, 상품, 주문 등) 들이 하나의 WAR파일로 톰캣 서버와 마리아 DB로 구성되어 있는

통합의 구조로 구성되어 있는 설계 형태 입니다. 

<br>

`MA 장점`으로는 개발 툴이나 서버 및 DB 등에서 전체 애플리케이션을 한번에 관리 및 개발 할 수 있고

개발, 배포, 빌드 등 절차 들이 빠르다는 것입니다.

이러한 장점은 시스템의 볼륨이 작고 개발 인원이 적을때 더 이점으로 작용됩니다.

<br>

`MA 단점` 으로는 대형 시스템을 개발 및 관리하는데 있어서 분리하게 작용하는 점이 많습니다.

시스템의 크기가 크고 무겁기 때문에 컴파일, 빌드, 서버 기동, 배포 등 시간적으로 오래 소요 되며

(오래전에 건너서 들은 바에 의하면 로컬 톰캣 재기동 하는데 몇시간 씩 걸려서.. 하루에 5번도 테스트를 못해본다고 했던...)

<br>

또한 하나의 큰 시스템을 여러 사람들이 나누어 하기엔 다른 컴포넌트에 끼치는 영향도가 높습니다.
장애가 나면 다른 컴포넌트에 영향을 많이 주게 됩니다.

그리고 업무 측면에서 만 보아도
시스템의 응집도가 높을 수록 시스템 전체를 파악하고 있을 수록 업무 리스크를 크게 주는데,

전체를 파악할 수 있는 현실적인 환경을 구축하기가 어렵습니다.

## Microservices Architecture(마이크로서비스 아키텍처)

근간은 SOA(Service Oriented Architecture/서비스 지향 아키텍쳐)에 두고 있습니다.

SOA는 엔터프라이즈 시스템을 중심으로 고안된 아키텍쳐라면, MSA는 SOA 사상에 근간을 두고 대용량 웹서비스 개발에 맞는 구조로 사상이 경량화 되고,

대규모 개발팀의 조직 구조에 맞도록 변형된 아키텍쳐 기법 입니다.

### 서비스

서비스는 데이타에서 부터 비지니스 로직까지 독립적으로 상호 컴포넌트간의 의존성이 없이 개발된 컴포넌트로 REST API와 같은 표준 인터페이스로 그 기능을 외부로 제공한다.

서비스 경계는 도메인(업무)의 경계를 따릅니다.

예를 들어 사용자 관리, 상품 관리, 주문 관리와 같은 각 업무 별로 서비스를 나눠서 정의합니다.

(예 - 사용자 관리 : user.mall.com, 상품관리 : goods.mall.com, 주문 관리 : order.mall.com)

사용자/상품 관리 처럼 여러개의 컴포넌트(업무)를 동시에 하나의 서비스로 합쳐서 정의 하지 않습니다.  

### 마이크로 서비스 아키텍쳐의 구조

각 컴포넌트(UX, 회원, 상품, 주문 등)는 서비스라는 형태로 구현되고 API를 이용하여 타 서비스와 통신을 한다.
배포 구조관점에서도 각 서비스는 독립된 서버로 타 컴포넌트와의 의존성이 없이 독립적으로 배포 된다.

예를 들어 사용자 관리 서비스는 독립적인 war파일로 개발되어, 독립된 톰캣 인스턴스에 배치된다. 확장을 위해서 서비스가 배치된 톰캣 인스턴스는 횡적으로 스케일 (인스턴스 수를 더함으로써)이 가능하고, 앞단에 로드 밸런서를 배치하여 서비스간의 로드를 분산 시킨다.

### 데이타 분리

데이타 저장관점에서는 하나의 DB를 사용하는 것이 아니라 서비스 별로 별도의 DB를 사용합니다.

보통 모노리틱 서비스의 경우에는 하나의 DB를 사용하는 경우가 일반적이지만,

MSA의 경우 서비스가 API에서 부터 DB까지 분리되는 수직 분할 원칙 (Vertical Slicing)에 따라서 독립된 DB를 갖는 형태 구조로 설계됩니다.

### API Gateway

MSA 설계에 있어서 많이 언급되는 컴포넌트 중의 하나가 api gateway 라는 컴포넌트 입니다.

api gateway는 마치 프록시 서버 처럼 api들 앞에서 모든 api에 대한 end point를 통합하고, 몇가지 추가적인 기능을 제공하는 미들웨어로, SOA의 ESB (Enterprise Service Bus)의 경량화 버전이다. Apigateway가 마이크로 서비스 아키텍쳐 상에서 수행하는 주요 기능을 살펴보면 다음과 같다.

#### EndPoint 통합 및 토폴로지 정리

마이크로 서비스 아키텍쳐의 문제점 중의 하나는 각 서비스가 다른 서버에 분리 배포 되기 때문에, API의 End point 즉, 서버의 URL이 각기 다르다는 것이다.

사용자 컴포넌트는 http://user.server.com, 상품 컴포넌트는 http://product.server.com 과 같은 분리된 URL을 사용하는데, 이는 API 사용자 경험 관점에서도 사용하기가 불편하다. 특히 마이크로 서비스 아키텍쳐는 컴포넌트를 되도록이면 업무 단위로 잘게 짜르는 fine grained (작은 덩어리)의 서비스를 지향하기 때문에, 컴포넌트의 URL 수는 더 많이 늘어 날 수 있다.

API를 사용하는 클라이언트에서 서버간의 통신이나, 서버간의 API 통신의 경우 p2p(Point to Point)형태로 토폴로지가 복잡해지고 거미줄 모양의 서비스 컴포넌트간의 호출 구조는 향후 관리의 문제를 일으킬 수 있다. 하나의 end point를 변경하였을때, 제대로 관리가 되지 않을 경우가 있다.






